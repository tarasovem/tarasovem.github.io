{"version":3,"names":[],"mappings":"","sources":["ymap.js"],"sourcesContent":["ymaps.ready(init);\n\nfunction init() {\n  var myMap = new ymaps.Map(\"map\", {\n      center: [55.76, 37.62],\n      zoom: 10,\n      behaviors: ['default', 'scrollZoom'],\n      controls: ['geolocationControl', 'zoomControl']\n    }),\n\n    // Создание макета балуна на основе Twitter Bootstrap.\n    MyBalloonLayout = ymaps.templateLayoutFactory.createClass(\n      '<div class=\"popover top\">' +\n      '<a class=\"close\" href=\"#\"></a>' +\n      '<div class=\"arrow\"></div>' +\n      '<div class=\"popover-inner\">' +\n      '$[[options.contentLayout observeSize minWidth=235 maxWidth=360]]' +\n      '</div>' +\n      '</div>', {\n        /**\n         * Строит экземпляр макета на основе шаблона и добавляет его в родительский HTML-элемент.\n         * @see https://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/layout.templateBased.Base.xml#build\n         * @function\n         * @name build\n         */\n        build: function () {\n          this.constructor.superclass.build.call(this);\n\n          this._$element = $('.popover', this.getParentElement());\n\n          this.applyElementOffset();\n\n          this._$element.find('.close')\n            .on('click', $.proxy(this.onCloseClick, this));\n        },\n\n        /**\n         * Удаляет содержимое макета из DOM.\n         * @see https://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/layout.templateBased.Base.xml#clear\n         * @function\n         * @name clear\n         */\n        clear: function () {\n          this._$element.find('.close')\n            .off('click');\n\n          this.constructor.superclass.clear.call(this);\n        },\n\n        /**\n         * Метод будет вызван системой шаблонов АПИ при изменении размеров вложенного макета.\n         * @see https://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/IBalloonLayout.xml#event-userclose\n         * @function\n         * @name onSublayoutSizeChange\n         */\n        onSublayoutSizeChange: function () {\n          MyBalloonLayout.superclass.onSublayoutSizeChange.apply(this, arguments);\n\n          if (!this._isElement(this._$element)) {\n            return;\n          }\n\n          this.applyElementOffset();\n\n          this.events.fire('shapechange');\n        },\n\n        /**\n         * Сдвигаем балун, чтобы \"хвостик\" указывал на точку привязки.\n         * @see https://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/IBalloonLayout.xml#event-userclose\n         * @function\n         * @name applyElementOffset\n         */\n        applyElementOffset: function () {\n          this._$element.css({\n            left: -(this._$element[0].offsetWidth / 2),\n            top: -(this._$element[0].offsetHeight + this._$element.find('.arrow')[0].offsetHeight)\n          });\n        },\n\n        /**\n         * Закрывает балун при клике на крестик, кидая событие \"userclose\" на макете.\n         * @see https://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/IBalloonLayout.xml#event-userclose\n         * @function\n         * @name onCloseClick\n         */\n        onCloseClick: function (e) {\n          e.preventDefault();\n\n          this.events.fire('userclose');\n        },\n\n        /**\n         * Используется для автопозиционирования (balloonAutoPan).\n         * @see https://api.yandex.ru/maps/doc/jsapi/2.1/ref/reference/ILayout.xml#getClientBounds\n         * @function\n         * @name getClientBounds\n         * @returns {Number[][]} Координаты левого верхнего и правого нижнего углов шаблона относительно точки привязки.\n         */\n        getShape: function () {\n          if (!this._isElement(this._$element)) {\n            return MyBalloonLayout.superclass.getShape.call(this);\n          }\n\n          var position = this._$element.position();\n\n          return new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([\n            [position.left, position.top - 160], [\n              position.left + this._$element[0].offsetWidth,\n              position.top + 100 + this._$element[0].offsetHeight + this._$element.find('.arrow')[0].offsetHeight\n            ]\n          ]));\n        },\n\n        /**\n         * Проверяем наличие элемента (в ИЕ и Опере его еще может не быть).\n         * @function\n         * @private\n         * @name _isElement\n         * @param {jQuery} [element] Элемент.\n         * @returns {Boolean} Флаг наличия.\n         */\n        _isElement: function (element) {\n          return element && element[0] && element.find('.arrow')[0];\n        }\n      }),\n\n    // Создание вложенного макета содержимого балуна.\n    MyBalloonContentLayout = ymaps.templateLayoutFactory.createClass(\n      '<h3 class=\"popover-title\">$[properties.balloonHeader]</h3>' +\n      '<div class=\"popover-content\">$[properties.balloonContent]</div>'\n    );\n\n\n\n  function itemsRender(items) {\n    $.each(items, function (index, value) {\n      // Создание метки с пользовательским макетом балуна.\n      var content;\n\n      if (value.video) {\n        content = '<a href=\"' +\n          value.origin +\n          '\" data-fancybox=\"map\" class=\"popover-video\"><img src=\"' +\n          value.preview +\n          '\" alt=\"\"></a>';\n      } else {\n        content = '<a href=\"' +\n        value.origin +\n        '\" data-fancybox=\"map\"><img src=\"' +\n        value.preview +\n        '\" alt=\"\"></a>';\n      }\n\n      myPlacemark = window.myPlacemark = new ymaps.Placemark(value.coord, {\n        balloonHeader: '<a href >' +\n          value.address +\n          '</a>',\n        balloonContent: content\n      }, {\n        iconLayout: 'default#image',\n        iconImageHref: 'img/custom-mark.png',\n        iconImageSize: [60, 70],\n        iconImageOffset: [-30, -70],\n        balloonShadow: false,\n        balloonLayout: MyBalloonLayout,\n        balloonContentLayout: MyBalloonContentLayout,\n        balloonPanelMaxMapArea: 0\n        // Не скрываем иконку при открытом балуне.\n        // hideIconOnBalloonOpen: false,\n        // И дополнительно смещаем балун, для открытия над иконкой.\n        // balloonOffset: [3, -40]\n      });\n\n      myMap.geoObjects.add(myPlacemark);\n    })\n  }\n\n  $.ajax({\n      url: \"ajax/map.json\"\n    }).done(function (data) {\n      itemsRender(data);\n    });\n\n\n  // отключаем зум колесиком мышки\n  myMap.behaviors.disable(['scrollZoom']);\n}"],"file":"ymap.js"}